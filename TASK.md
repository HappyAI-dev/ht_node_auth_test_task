# HT Node.js test task

# ⚠️ Процесс выполнения и сдачи задания
1. Сделать fork репозитория
2. Выполнить задание в отфорканном репозитории в уже созданной кодовой базе
3. Кинуть PR на основной репозиторий
4. Написать в тг @dimatatatarin

## Реализация реферальной системы 
C бонусами и механикой уровней

### Введение

В рамках текущего проекта необходимо дополнить уже существующую систему регистрации и авторизации пользователей новым функционалом — реферальной системой. Пользователи будут получать бонусы в виде кредитов за приглашение новых пользователей, а также смогут улучшать свои условия по мере накопления приглашений и соблюдения стриков.

### Задачи

1. **Добавить в базу данных новое поле для хранения реферального кода пользователя.**
    - Для каждого пользователя добавляется новое поле `referral_code` в объекте пользователя.
    - Каждый пользователь может иметь уникальный реферальный код, который будет использоваться для приглашения новых пользователей.
2. **Миграция базы данных.**
    - Создать миграцию для добавления нового поля в таблицу пользователей.
    - Убедиться, что новое поле `referral_code` не влияет на существующую логику работы с пользователями.
3. **Реализация реферальной логики:**
    - **Первичный бонус.** Когда новый пользователь регистрируется и указывает реферальный код, как минимум одного приглашённого пользователя, оба участника (пригласивший и приглашённый) получают по 100 кредитов.
4. **Механика уровней:**
    - **Уровень 1:** Пригласивший пользователь накапливает кредиты за каждого приглашённого (100 кредитов). После того как он пригласит 3 человек, он автоматически переходит на уровень 2.
    - **Уровень 2:** Пригласивший пользователь, находясь на втором уровне, получает 150 кредитов за каждого нового приглашённого.
    - **Обновление уровня:** При достижении 3 приглашённых пользователей пригласивший пользователь автоматически переходит на уровень 2, и начинает получать по 150 кредитов за каждого нового приглашённого.
5. **Стрик по дням:**
    - **Определение стрика.** Стрик считается как количество дней подряд, когда пригласивший пользователь приглашал хотя бы одного нового пользователя.
    - Если в течение дня не было новых приглашений, стрик сбивается и начинает накапливаться заново c 0.
    - Для каждого дня с новым приглашением, стрик увеличивается на 1 день.
    - Стрик хранится. При приглашении пользователя, приглашающий пользователь получает кредиты, соответствующие уровню, + число стрика. Если приглашающий пользователь приглашал 5 дней подряд, то он получит кредиты, соответствующие уровню, + 5.
6. **Документация:**
    - Обновить документацию API, чтобы описать новые эндпоинты и логику работы реферальной системы.

### Подробности реализации

1. **Регистрация нового пользователя:**
    - Новый пользователь получает уникальный `referral_code` (например, это может быть случайный набор символов).
    - При регистрации пользователь может ввести `referral_code` пригласившего его пользователя.
    - Если код введён верно, то пригласившему и новому пользователю начисляются по 100 кредитов.
2. **Механика уровней и бонусов:**
    - Если пользователь пригласил 3 и более человек, его уровень повышается на 2, и он начинает получать 150 кредитов за каждого нового приглашённого.
    - Логика повышения уровня проверяется при каждом новом приглашении.
3. **Реализация стрика:**
    - Отложенная задача каждый день проверяет дату последнего приглашения и обновляет стрик каждого пользователя либо на +1, либо на 0.

### Сроки

- Время на выполнение: до 5 рабочих дней.

### Ожидаемый результат

- Готовая и протестированная реферальная система с бонусами и уровнями.
- Улучшение функционала базы данных с новой миграцией и полями.
- Корректная работа стриков, уровня пользователей и начисления кредитов.